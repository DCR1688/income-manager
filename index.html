<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>收入管理系统 - 云端同步优化</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        :root {
            --ios-blue: #007AFF;
            --ios-gray: #8E8E93;
            --ios-light-gray: #F2F2F7;
            --ios-card-bg: #FFFFFF;
            --ios-border: #C6C6C8;
            --ios-green: #34C759;
            --ios-red: #FF3B30;
            --ios-orange: #FF9500;
            --ios-purple: #AF52DE;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Text', 'SF Pro Display', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            background: var(--ios-light-gray);
            color: #000;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding: 16px;
            padding-bottom: calc(16px + env(safe-area-inset-bottom));
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            width: 100%;
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeIn 0.8s ease-out;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            border-radius: 22px;
            background: var(--ios-blue);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            color: white;
            font-size: 40px;
            box-shadow: 0 4px 20px rgba(0, 122, 255, 0.2);
        }
        
        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .header p {
            font-size: 17px;
            color: var(--ios-gray);
            font-weight: 400;
        }
        
        .cloud-config-section {
            background: var(--ios-card-bg);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 0.5px solid var(--ios-border);
            animation: slideUp 0.6s ease-out;
        }
        
        .cloud-config-section h2 {
            font-size: 20px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 16px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        .form-group input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--ios-border);
            border-radius: 12px;
            font-size: 16px;
        }
        
        .btn {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--ios-blue);
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
        }
        
        .btn-secondary {
            background: var(--ios-green);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #2a9e48;
        }
        
        .sync-status {
            margin-top: 20px;
            padding: 12px;
            border-radius: 12px;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .sync-status.connected {
            background: #e6f4ea;
            color: #137333;
        }
        
        .sync-status.disconnected {
            background: #fce8e6;
            color: #c5221f;
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
            margin-bottom: 30px;
        }
        
        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .option-card {
            background: var(--ios-card-bg);
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            border: 0.5px solid var(--ios-border);
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 220px;
            animation: slideUp 0.6s ease-out;
        }
        
        .option-card:nth-child(2) {
            animation-delay: 0.1s;
        }
        
        .option-card:active {
            transform: scale(0.97);
            background: rgba(255, 255, 255, 0.7);
        }
        
        .option-icon {
            width: 70px;
            height: 70px;
            border-radius: 17px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 30px;
            color: white;
        }
        
        .sales-icon {
            background: var(--ios-purple);
        }
        
        .manager-icon {
            background: var(--ios-orange);
        }
        
        .option-card h2 {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .option-card p {
            font-size: 15px;
            color: var(--ios-gray);
            line-height: 1.5;
        }
        
        .footer {
            text-align: center;
            margin-top: 40px;
            color: var(--ios-gray);
            font-size: 14px;
            animation: fadeIn 1s ease-out;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { 
                opacity: 0;
                transform: translateY(20px);
            }
            to { 
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-cloud"></i>
            </div>
            <h1>云端同步设置</h1>
            <p>配置您的GitHub信息以实现自动同步</p>
        </div>
        
        <div class="cloud-config-section">
            <h2><i class="fas fa-cog"></i> 同步配置</h2>
            
            <div class="form-group">
                <label for="github-username">GitHub用户名</label>
                <input type="text" id="github-username" placeholder="输入您的GitHub用户名">
            </div>
            
            <div class="form-group">
                <label for="github-token">GitHub Personal Access Token</label>
                <input type="password" id="github-token" placeholder="输入您的GitHub Token">
            </div>
            
            <div class="form-group">
                <label for="repo-name">仓库名称</label>
                <input type="text" id="repo-name" value="income-manager" placeholder="输入仓库名称">
            </div>
            
            <div class="form-group">
                <label for="encryption-password">数据加密密码</label>
                <input type="password" id="encryption-password" placeholder="设置数据加密密码">
            </div>
            
            <button class="btn btn-primary" onclick="saveCloudConfig()">
                <i class="fas fa-save"></i> 保存配置
            </button>
            
            <button class="btn btn-secondary" onclick="testConnection()" style="margin-left: 10px;">
                <i class="fas fa-wifi"></i> 测试连接
            </button>
            
            <div class="sync-status" id="syncStatus">
                <i class="fas fa-info-circle"></i>
                <span>请先配置云端同步设置</span>
            </div>
        </div>
        
        <div class="options-grid">
            <div class="option-card" onclick="navigateTo('loan-calculator')">
                <div class="option-icon sales-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <h2>业务员提成</h2>
                <p>计算和管理业务员的贷款提成收入，支持自动计算和导出功能</p>
            </div>
            
            <div class="option-card" onclick="navigateTo('income-manager')">
                <div class="option-icon manager-icon">
                    <i class="fas fa-user-cog"></i>
                </div>
                <h2>经理提成</h2>
                <p>查看和管理团队提成数据，支持多维度统计和分析功能</p>
            </div>
        </div>
        
        <div class="footer">
            <p>© 2023 收入管理系统 - 专为贷款行业设计</p>
            <p style="font-size: 12px; margin-top: 8px;">自动同步功能需要稳定的网络连接</p>
        </div>
    </div>

    <script>
        // 配置存储键名
        const CONFIG_KEYS = {
            GITHUB_USERNAME: 'github_username',
            GITHUB_TOKEN: 'github_token',
            REPO_NAME: 'repo_name',
            ENCRYPTION_PASSWORD: 'encryption_password'
        };
        
        // 加载保存的配置
        function loadCloudConfig() {
            document.getElementById('github-username').value = localStorage.getItem(CONFIG_KEYS.GITHUB_USERNAME) || '';
            document.getElementById('github-token').value = localStorage.getItem(CONFIG_KEYS.GITHUB_TOKEN) || '';
            document.getElementById('repo-name').value = localStorage.getItem(CONFIG_KEYS.REPO_NAME) || 'income-manager';
            document.getElementById('encryption-password').value = localStorage.getItem(CONFIG_KEYS.ENCRYPTION_PASSWORD) || '';
            
            // 检查是否已配置
            checkConfigStatus();
        }
        
        // 保存云端配置
        function saveCloudConfig() {
            const username = document.getElementById('github-username').value.trim();
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('repo-name').value.trim() || 'income-manager';
            const password = document.getElementById('encryption-password').value.trim();
            
            if (!username || !token || !password) {
                alert('请填写所有必填字段');
                return;
            }
            
            // 保存到localStorage
            localStorage.setItem(CONFIG_KEYS.GITHUB_USERNAME, username);
            localStorage.setItem(CONFIG_KEYS.GITHUB_TOKEN, token);
            localStorage.setItem(CONFIG_KEYS.REPO_NAME, repo);
            localStorage.setItem(CONFIG_KEYS.ENCRYPTION_PASSWORD, password);
            
            // 更新状态
            updateSyncStatus('connected', '配置已保存，可以开始使用同步功能');
            
            alert('配置保存成功！');
        }
        
        // 测试连接
        async function testConnection() {
            const username = document.getElementById('github-username').value.trim();
            const token = document.getElementById('github-token').value.trim();
            const repo = document.getElementById('repo-name').value.trim() || 'income-manager';
            
            if (!username || !token) {
                alert('请先填写GitHub用户名和Token');
                return;
            }
            
            updateSyncStatus('connecting', '正在测试连接...');
            
            try {
                const apiUrl = `https://api.github.com/repos/${username}/${repo}`;
                const response = await fetch(apiUrl, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'User-Agent': 'IncomeManagerApp'
                    }
                });
                
                if (response.ok) {
                    updateSyncStatus('connected', '连接成功！可以正常使用云端同步功能');
                } else if (response.status === 404) {
                    updateSyncStatus('disconnected', '仓库不存在，请检查仓库名称是否正确');
                } else if (response.status === 401) {
                    updateSyncStatus('disconnected', 'Token无效，请检查Token权限');
                } else {
                    updateSyncStatus('disconnected', `连接失败: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('连接测试失败:', error);
                updateSyncStatus('disconnected', '连接失败，请检查网络连接');
            }
        }
        
        // 更新同步状态显示
        function updateSyncStatus(status, message) {
            const statusElement = document.getElementById('syncStatus');
            statusElement.innerHTML = `<i class="fas fa-${getStatusIcon(status)}"></i><span>${message}</span>`;
            
            // 移除所有状态类
            statusElement.classList.remove('connected', 'disconnected', 'connecting');
            
            // 添加当前状态类
            if (status) {
                statusElement.classList.add(status);
            }
        }
        
        // 获取状态图标
        function getStatusIcon(status) {
            switch(status) {
                case 'connected': return 'check-circle';
                case 'disconnected': return 'exclamation-circle';
                case 'connecting': return 'sync-alt';
                default: return 'info-circle';
            }
        }
        
        // 检查配置状态
        function checkConfigStatus() {
            const username = localStorage.getItem(CONFIG_KEYS.GITHUB_USERNAME);
            const token = localStorage.getItem(CONFIG_KEYS.GITHUB_TOKEN);
            const password = localStorage.getItem(CONFIG_KEYS.ENCRYPTION_PASSWORD);
            
            if (username && token && password) {
                updateSyncStatus('connected', '已配置云端同步，可以正常使用');
            } else {
                updateSyncStatus('disconnected', '请先配置云端同步设置');
            }
        }
        
        // 导航到相应页面
        function navigateTo(type) {
            // 检查是否已配置
            const username = localStorage.getItem(CONFIG_KEYS.GITHUB_USERNAME);
            const token = localStorage.getItem(CONFIG_KEYS.GITHUB_TOKEN);
            const password = localStorage.getItem(CONFIG_KEYS.ENCRYPTION_PASSWORD);
            
            if (!username || !token || !password) {
                alert('请先配置云端同步设置');
                return;
            }
            
            // 将配置信息传递给目标页面
            sessionStorage.setItem('cloudConfig', JSON.stringify({
                username,
                token,
                repo: localStorage.getItem(CONFIG_KEYS.REPO_NAME) || 'income-manager',
                password
            }));
            
            // 跳转到目标页面
            if (type === 'loan-calculator') {
                window.location.href = 'loan-calculator.html';
            } else if (type === 'income-manager') {
                window.location.href = 'income-manager.html';
            }
        }
        
        // 页面加载时初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadCloudConfig();
            
            // 检查网络状态
            window.addEventListener('online', function() {
                updateSyncStatus('connected', '网络已连接，可以同步数据');
            });
            
            window.addEventListener('offline', function() {
                updateSyncStatus('disconnected', '网络已断开，无法同步数据');
            });
        });
    </script>
</body>
</html>